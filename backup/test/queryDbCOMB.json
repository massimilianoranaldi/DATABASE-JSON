[
  {
    "id": "1",
    "nomeCapitolo": "*** COMB",
    "paragrafi": [
      {
        "id": "1.1",
        "nomeParagrafo": "Estrae eventi verso il billing, con evidenza data attivazione/cessazione per int id. Utilizzata nello scenario di NP interna",
        "codicePlSql": "select distinct \nextractvalue(xmltype(m.message_xml),'descendant::ns0:idCliente','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as idCliente,\nd.value as order_id, \n--r.id as root_id, \n--r.name as root_name,\na.id,a.name, \nr.ts_created,\n(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@tipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as tipo_ordine,\n--(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@sottotipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as sottotipo_ordine,\n--(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/ns0:causaleOrdine','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as causale_ordine,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:extIdSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extId_si,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:numeroTelefono','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as numeroTelefono,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:dataAttivazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dataAttivazione,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:dataCessazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dataCessazione,\nextractvalue(value(t),'ns0:billingElement/ns0:extIdBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extid_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:typeOpBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as type_op_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:idBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as id_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:dtAttivazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtAttivazione_BE,\n--extractvalue(value(t),'ns0:billingElement/ns0:dtCessazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtCessazione_BE\n--extractvalue(value(t),'ns0:billingElement/ns0:idOrdine','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as idordine_BE\nextractvalue(xmltype(m.message_xml),'descendant::ns0:CRMtipoSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as CRMtipoSI,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:CRMsottotipoSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as CRMsottotipoSI\nfrom request r, detail d, request r1, action a, action_msg m,\nTABLE ( XMLSEQUENCE(EXTRACT(xmltype(m.message_XML),'descendant::ns0:billingElement', 'xmlns:ns0=http://billing.wind.it/esb/OrderManagement'))) t\nwhere r.id=d.root_id\nand d.name='id_odl_crm'\nand \n(\n    d.value in (-- attivazioni \n        /*'1-612511851773',\n        '1-615564746976',\n        '1-616074838718',\n        '1-615892073226',\n        '1-616676666948',\n        '1-617812697738',\n        '1-614841180873',\n        '1-617227516783', \n        '1-617379290097', \n        '1-617893341026',*/\n             '1-614940023375' -- '1-619157290421'\n) \n     or\n    d.value in ( -- cessazioni \n             '1-618125223280'--,--     \n            /* '1-617947246902',--     \n             '1-617560729470',--\n             '1-618439781329',--\n             '1-618822370337',--    live\n             '1-619066680576',--     \n             '1-616486927246',--     \n             '1-616198469176',--     \n             '1-619639156003',--    live\n             '1-619157290421'  */\n        )\n)\nand r.id=r1.root_id\nand r1.id=a.request_id\nand a.message_id=m.id\nand a.system='kenan'\nand a.direction='outbound'\norder by idcliente,tipo_ordine,numerotelefono;",
        "outPutSql": "IDCLIENTE\tORDER_ID\tID\tNAME\tTS_CREATED\tTIPO_ORDINE\tEXTID_SI\tNUMEROTELEFONO\tDATAATTIVAZIONE\tDATACESSAZIONE\tEXTID_BE\tCRMTIPOSI\tCRMSOTTOTIPOSI\n559061075\t1-618822370337\t69186009984\tDeactivation Service Instance\t01-MAR-24 08.23.28.045127000 PM\tCessazione\t1,60871E+12\tA21608711970339\t\t2024-03-01T20:25:54+01:00\t1,61E+12\tTE\tAPPCON\n559061075\t1-618822370337\t69186009984\tDeactivation Service Instance\t01-MAR-24 08.23.28.045127000 PM\tCessazione\t1,60871E+12\tA21608711970339\t\t2024-03-01T20:25:54+01:00\t1,61E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284458659\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\t415401001\t\t2024-02-26T00:00:00+01:00\t1,56E+12\tTC\tSVOIP\n601099904\t1-619639156003\t69284458659\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\t415401001\t\t2024-02-26T00:00:00+01:00\t1,56E+12\tTC\tSVOIP\n601099904\t1-619639156003\t69284459710\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\tA21562750044945\t\t2024-03-12T13:02:12+01:00\t1,56E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284459710\tDeactivation Service Instance\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t1,56275E+12\tA21562750044945\t\t2024-03-12T13:02:12+01:00\t1,56E+12\tTE\tAPPCON\n601099904\t1-619639156003\t69284460185\tChange Billing Element Account Level\t12-MAR-24 12.59.08.273482000 PM\tCessazione\t\t\t\t\t1,56E+12\t\t"
      }
    ]
  },
  {
    "id": "2",
    "nomeCapitolo": "FIXED CRP: CHECK WC/QC e LOGISTICA",
    "paragrafi": [
      {
        "id": "2.1",
        "nomeParagrafo": "Estrae per ogni ordine le caratteristiche legate alla WC/WC, gli esiti di sblocco e le date di start delle subrequest",
        "codicePlSql": "select * from\n(select r.id as root_id,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:idCommercialOrder','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as id_ordine, \n r.name as req_name,\n extractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:bssOrder','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as bssOrder,\n  extractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:datiOrder/ns0:flagContCli','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as flagContCli,\n    extractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:flagWCall','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as flagWCall,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:datiVenditore/ns0:canaleVendita','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as canaleVendita,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/@tipo','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as tipo,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/@sottotipo','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as sottotipo, \nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:causaleOrdine','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as causale,\nr.ts_created, r.status as req_root_status,\n(select ts_end from action where request_id=r.id and name='Response Request async CVP') as OutcomeCvp --- Esito CVP\n,(select ts_end from action where request_id=r.id and name='Send Welcome Call') as Send_WC --invio richiesta sblocco verso siebel \n,(select ts_end from action where request_id=r.id and name='Receive Welcome Call Response') as ResponseWC_ACK --presa in carico\n,(select ts_end from action where request_id=r.id and name='Receive Unlock Order') as Receive_Order_UNLOCK --CONTINUE - sblocco logistica\n,(select ts_end from action where request_id=r.id and name='Receive Unlock Order Wireline') as Receive_UnlockOrder_SP--END_FIS, manda in abort la SP\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'MnpRecipient' and z.name ='Send Request Mnp') as SendRequestMNP_date\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'MnpRecipient' and z.name ='Recipient outcome Mnp') as RecipientOutcome_Mnp_date\n,(select count(*) from request where root_id=r.id and name='Logistics') as Logistiche \n,(select count(*) from request where root_id=r.id and name='Network') as Network \n,(select count(*) from request where root_id=r.id and name='MnpRecipient') as MnpRecipient\n,(select count(*) from request where root_id=r.id and name='Service Provisioning') as SP  \n,(select count (*) from action where request_id=r.id and name='Receive Unlock Order') as UnlockMob --invio richiesta sblocco verso siebel \n,(select count (*) from action where request_id=r.id and name='Receive Unlock Order Wireline') as UnlockFixed\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'Service Provisioning' and z.name ='Send Order Service Provisioning') as Avvio_SP\n,(select count (*) from action z, request zz where z.request_id = zz.id and zz.root_id= r.root_id and zz.name = 'Logistics' and z.name ='Send order odn') as LogisticsDetails\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id= r.root_id and zz.name = 'Logistics' and z.name ='Send order odn') as LogisticsDetails_date\n,(select count (*) from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'Logistics' and z.name ='Send order handset odvr') as LogisticsDetailsCPE\n,(select z.ts_end from action z, request zz where z.request_id = zz.id and zz.root_id = r.root_id and zz.name = 'Logistics' and z.name ='Send order handset odvr') as LogisticsDetailsCPE_date\n--,(select 1 from request where root_id=r.id and name='Network') as network --END_FIS, manda in abort la SP\nfrom request r, request_doc d\nwhere \nr.name in ('In Order', 'Extend Order')\nand  exists (select 1 from action z where z.request_id = r.id and z.name in \n('Receive Unlock Order','Receive Unlock Order', 'Receive Welcome Call Response','Receive Unlock Order Wireline') \nand z.status = 'SA')\nand exists (select 1 from action z, request zz where z.request_id = zz.id and zz.root_id= r.root_id and zz.name = 'Logistics' and z.name ='Send order odn')\nand exists (select 1 from request zz where zz.root_id= r.root_id and zz.name = 'Service Provisioning')\n--and r.id in ('3499623899','3484883109','3431904065','3467353921','3421860956','3425204563')\nand r.ts_created>to_date('01/06/2024', 'dd/mm/yyyy')\nand r.document_id=d.id\nand r.status = 'SA'\n and rownum<10);",
        "outPutSql": "ROOT_ID\tID_ORDINE\tREQ_NAME\tBSSORDER\tFLAGCONTCLI\tFLAGWCALL\tCANALEVENDITA\tTIPO\tSOTTOTIPO\tCAUSALE\tTS_CREATED\tREQ_ROOT_STATUS\tOUTCOMECVP\tSEND_WC\tRESPONSEWC_ACK\tORDER_UNLOCK\tUNLOCKORDER_SP\tLOGISTICHE\tNETWORK\tMNPRECIPIENT\tSP\tUNLOCKMOB\tUNLOCKFIXED\tLOGISTICSDETAILS\tLOGISTICSDETAILSCPE\n3549012487\t1-629354705694\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t27-JUN-24 07.31.49.129163000 PM\tSA\t28-JUN-24 08.58.33.000000000 AM\t28-JUN-24 08.58.36.000000000 AM\t28-JUN-24 08.58.36.000000000 AM\t\t28-JUN-24 11.29.18.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3570289096\t1-631900871753\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t25-JUL-24 05.08.21.476784000 PM\tSA\t26-JUL-24 09.58.37.000000000 AM\t26-JUL-24 10.23.11.000000000 AM\t26-JUL-24 10.23.12.000000000 AM\t27-JUL-24 09.40.47.000000000 PM\t30-JUL-24 09.42.45.000000000 AM\t2\t1\t0\t2\t1\t1\t0\t2\n3574461716\t1-632399173651\tIn Order\t\tY\tN\tEX\tAttivazione\tAttivazione\tPrima Attivazione\t31-JUL-24 05.37.43.091181000 PM\tSA\t31-JUL-24 08.07.28.000000000 PM\t31-JUL-24 08.07.30.000000000 PM\t31-JUL-24 08.07.30.000000000 PM\t\t07-AUG-24 10.21.56.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3578439547\t1-632908479369\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t06-AUG-24 11.19.43.004896000 AM\tSA\t06-AUG-24 12.04.50.000000000 PM\t06-AUG-24 12.04.53.000000000 PM\t06-AUG-24 12.04.54.000000000 PM\t\t10-AUG-24 10.10.41.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3568437865\t1-631680491604\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t23-JUL-24 03.10.31.576717000 PM\tSA\t23-JUL-24 05.29.12.000000000 PM\t23-JUL-24 05.29.25.000000000 PM\t23-JUL-24 05.29.25.000000000 PM\t\t24-JUL-24 09.31.43.000000000 AM\t0\t0\t0\t1\t0\t1\t0\t0\n3572370220\t1-632117269092\tIn Order\tY\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t29-JUL-24 02.03.31.758450000 PM\tSA\t29-JUL-24 03.44.05.000000000 PM\t29-JUL-24 03.46.46.000000000 PM\t29-JUL-24 03.46.46.000000000 PM\t\t30-JUL-24 08.48.16.000000000 AM\t1\t1\t0\t1\t0\t1\t0\t1\n3563041104\t1-630929161251\tIn Order\t\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t16-JUL-24 09.34.21.908998000 AM\tSA\t29-JUL-24 11.22.20.000000000 AM\t29-JUL-24 11.43.29.000000000 AM\t29-JUL-24 11.43.29.000000000 AM\t\t31-JUL-24 11.09.05.000000000 AM\t0\t0\t0\t2\t0\t1\t0\t0\n3567585601\t1-631574862220\tIn Order\tY\tY\tN\tTM\tAttivazione\tAttivazione\tPrima Attivazione\t22-JUL-24 05.29.02.192241000 PM\tSA\t23-JUL-24 09.15.56.000000000 AM\t23-JUL-24 09.15.59.000000000 AM\t23-JUL-24 09.15.59.000000000 AM\t\t25-JUL-24 09.28.40.000000000 AM\t1\t0\t0\t1\t0\t1\t0\t1\n3578463658\t1-632914755505\tIn Order\t\tY\tN\tAS\tAttivazione\tAttivazione\tPrima Attivazione\t06-AUG-24 11.44.32.894612000 AM\tSA\t06-AUG-24 03.25.03.000000000 PM\t06-AUG-24 03.25.05.000000000 PM\t06-AUG-24 03.25.05.000000000 PM\t\t06-AUG-24 05.32.28.000000000 PM\t0\t0\t0\t1\t0\t1\t0\t0"
      }
    ]
  },
  {
    "id": "3",
    "nomeCapitolo": "ESTRAZIONE NUMEROSITA PRODOTTI SU ORDINE CRM",
    "paragrafi": [
      {
        "id": "3.1",
        "nomeParagrafo": "Estrae i campi dell'ordine e la numerosità dei prodotti a partire da id ordine e nome della action inbound (query 1)",
        "codicePlSql": "select --am.*,\nr.id,r.status,r.name,r.ts_created,\nextractValue(xmltype(message_xml),'commercialOrder/order/@tipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"')as tipo_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@sottotipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as sottotipo_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@causaleOrdine','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as causale_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@bssOrder','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as bss_order,\nextractValue(xmltype(message_xml),'commercialOrder/order/@flagSospensione','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as flag_sospensione,\n(select count(id) from request where name='Network' and root_id=rr.root_id) as count_network,\n(case when (select count (id) from request where name='Logistics' and root_id=rr.root_id)>=1 then 'Y' else 'N' end) as Logistica,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESSPREPAG'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_wlessprep,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESS'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_wless,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''CPEM'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_cpem,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''GSS'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_gss\n,extractvalue(value(te),'./*[@tipo=''TE'']/@componentRoot','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') componentRoot\n,extractvalue(value(te),'./*[@tipo=''TE'']/@integrationId','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') integrationIdTe\n,extractvalue(value(te),'./*[@tipo=''TE'']/@sottoTipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') sottoTipote\n,extractvalue(value(te),'./*[@tipo=''TE'']/@componentPadre','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') componentPadrete\n,extractvalue(value(te),'./*[@tipo=''TE'']/nomeAttributo[.=\"Numero Voce Portato\"]/@valore','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePortato\n,extractvalue(value(te),'./*[@tipo=''TE'']/nomeAttributo[.=\"Numero Voce Precedente\"]/@valore','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePrecedente\n--,extractvalue(value(te),'./*[@tipo=''TE'']/@numeroVocePrecedente','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePrecedente\n,r.id\nfrom action r, request rr ,action_msg am,\n--TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''PRD'']',\n--'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"'))) p,\nTABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''TC'']','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"'))) pp    \n,TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''TE'' and @sottoTipo=\"MNPIN\"]','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"'))) te    \nwhere r.name='Receive In Order'--'Receive Out Order'\nand r.status='SA'\n--and r.ts_created>sysdate-10\nand RR.ID=r.request_id\n--and rr.root_id=3449071259\nand am.id=r.message_id\nand rownum<10\n--and r.id='3450777873'\nand rr.root_id =(select distinct root_id from detail where value='1-624901434706'  )",
        "outPutSql": "ID\tSTATUS\tNAME\tTS_CREATED\tTIPO_ORDINE\tSOTTOTIPO_ORDINE\tCAUSALE_ORDINE\tBSS_ORDER\tFLAG_SOSPENSIONE\tCOUNT_NETWORK\tLOGISTICA\tNUM_PRD_WLESSPREP\tNUM_PRD_WLESS\tNUM_PRD_CPEM\tNUM_PRD_GSS\tCOMPONENTROOT\tINTEGRATIONIDTE\tSOTTOTIPOTE\tCOMPONENTPADRETE\tNUMEROVOCEPORTATO\tNUMEROVOCEPRECEDENTE\tID_1\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623894496770\t1623894497664\tMNPIN\t1623894497339\t3472941972\t3283736613\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623895203725\t1623895203778\tMNPIN\t1623895203732\t3453342297\t3205755732\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623894496770\t1623894497664\tMNPIN\t1623894497339\t3472941972\t3283736613\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623895203725\t1623895203778\tMNPIN\t1623895203732\t3453342297\t3205755732\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623894496770\t1623894497664\tMNPIN\t1623894497339\t3472941972\t3283736613\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623895203725\t1623895203778\tMNPIN\t1623895203732\t3453342297\t3205755732\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623894496770\t1623894497664\tMNPIN\t1623894497339\t3472941972\t3283736613\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623895203725\t1623895203778\tMNPIN\t1623895203732\t3453342297\t3205755732\t69880303366"
      },
      {
        "id": "3.2",
        "nomeParagrafo": "Estrae i campi dell'ordine e la numerosità dei prodotti a partire da id ordine e nome della action inbound (query 2)",
        "codicePlSql": "select --am.*,\nr.id,r.status,r.name,r.ts_created,\nextractValue(xmltype(message_xml),'commercialOrder/order/@tipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"')as tipo_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@sottotipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as sottotipo_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@causaleOrdine','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as causale_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@bssOrder','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as bss_order,\nextractValue(xmltype(message_xml),'commercialOrder/order/@flagSospensione','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as flag_sospensione,\n(select count(id) from request where name='Network' and root_id=rr.root_id) as count_network,\n(case when (select count (id) from request where name='Logistics' and root_id=rr.root_id)>=1 then 'Y' else 'N' end) as Logistica,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESSPREPAG'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_wlessprep,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESS'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_wless,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''CPEM'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_cpem,\n(SELECT count(*) FROM action_msg b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''GSS'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_gss,\nextractvalue(value(p),'./*[@tipo=''PRD'']/@integrationId','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') integrationIdPrd\n,extractvalue(value(p),'./*[@tipo=''PRD'']/@id','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') rowIdPRD\n,extractvalue(value(p),'descendant::*/*/@serviceId','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') serviceIdPRD\n,extractvalue(value(p),'descendant::*/*[@tipo=''TC'' and @sottoTipo=\"SRVPREPMOB\"]/nomeAttributo[.=\"MSISDN\"]/@valore','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') msisdn\n,extractvalue(value(p),'descendant::*/*[@tipo=''TC'' and @sottoTipo=\"SRVPREPMOB\"]/@serviceId','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') serviceIdTC\n,extractvalue(value(p),'descendant::*/*[@tipo=''TE'']/nomeAttributo[.=\"Numero Voce Portato\"]/@valore','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePortato\n,extractvalue(value(p),'descendant::*/*[@tipo=''TE'']/nomeAttributo[.=\"Numero Voce Precedente\"]/@valore','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePrecedente\n,r.id\nfrom action r, request rr ,action_msg am,\nTABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''PRD'']','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"'))) p\nwhere r.name='Receive In Order'--'Receive Out Order'\nand r.status='SA'\n--and r.ts_created>sysdate-10\nand RR.ID=r.request_id\n--and rr.root_id=3449071259\nand am.id=r.message_id\nand rownum<3\n--and r.id='3450777873'\nand rr.root_id = (select distinct root_id from detail where value='1-620245797028')",
        "outPutSql": "ID\tSTATUS\tNAME\tTS_CREATED\tTIPO_ORDINE\tSOTTOTIPO_ORDINE\tCAUSALE_ORDINE\tBSS_ORDER\tFLAG_SOSPENSIONE\tCOUNT_NETWORK\tLOGISTICA\tNUM_PRD_WLESSPREP\tNUM_PRD_WLESS\tNUM_PRD_CPEM\tNUM_PRD_GSS\tINTEGRATIONIDPRD\tROWIDPRD\tSERVICEIDPRD\tMSISDN\tSERVICEIDTC\tNUMEROVOCEPORTATO\tNUMEROVOCEPRECEDENTE\tID_1\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623894496770\t1-7Z2CXV2P\t3283736613\t3283736613\t3283736613\t3472941972\t3283736613\t69880303366\n69880303366\tSA\tReceive In Order\t13/05/2024 09:51:39,534342\tReitero\tAttivazione\tPrima Attivazione\t\t0\t2\tN\t2\t0\t0\t0\t1623895203725\t1-7Z2HZSN0\t3205755732\t3205755732\t3205755732\t3453342297\t3205755732\t69880303366"
      },
      {
        "id": "3.3",
        "nomeParagrafo": "Estrae i campi dell'ordine e la numerosità dei prodotti a partire da id ordine e nome della action inbound (STORICO)",
        "codicePlSql": "select --am.*,\nr.id,r.status,r.name,r.ts_created,\nextractValue(xmltype(message_xml),'commercialOrder/order/@tipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"')as tipo_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@sottotipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as sottotipo_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@causaleOrdine','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as causale_ordine,\nextractValue(xmltype(message_xml),'commercialOrder/order/@bssOrder','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as bss_order,\nextractValue(xmltype(message_xml),'commercialOrder/order/@flagSospensione','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') as flag_sospensione,\n(select count(id) from request_hs where name='Network' and root_id=rr.root_id) as count_network,\n(case when (select count (id) from request_hs where name='Logistics' and root_id=rr.root_id)>=1 then 'Y' else 'N' end) as Logistica,\n(SELECT count(*) FROM action_msg_hs b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESSPREPAG'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_wlessprep,\n(SELECT count(*) FROM action_msg_hs b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''WLESS'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_wless,\n(SELECT count(*) FROM action_msg_hs b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''CPEM'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_cpem,\n(SELECT count(*) FROM action_msg_hs b, TABLE ( XMLSEQUENCE ( EXTRACT ( xmltype (b.message_xml), '/commercialOrder/order/lineItem[@sottoTipo=''GSS'']',   'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"  '))) p  where  b.id=am.id) num_prd_gss\n,extractvalue(value(te),'./*[@tipo=''TE'']/@componentRoot','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') componentRoot\n,extractvalue(value(te),'./*[@tipo=''TE'']/@integrationId','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') integrationIdTe\n,extractvalue(value(te),'./*[@tipo=''TE'']/@sottoTipo','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') sottoTipote\n,extractvalue(value(te),'./*[@tipo=''TE'']/@componentPadre','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') componentPadrete\n,extractvalue(value(te),'./*[@tipo=''TE'']/nomeAttributo[.=\"Numero Voce Portato\"]/@valore','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePortato\n,extractvalue(value(te),'./*[@tipo=''TE'']/nomeAttributo[.=\"Numero Voce Precedente\"]/@valore','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePrecedente\n--,extractvalue(value(te),'./*[@tipo=''TE'']/@numeroVocePrecedente','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"') numeroVocePrecedente\n,r.id\nfrom action_hs r, request_hs rr ,action_msg_hs am,\n--TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''PRD'']',\n--'xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"'))) p,\nTABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''TC'']','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"'))) pp    \n,TABLE ( XMLSEQUENCE(EXTRACT(xmltype(am.message_xml),'/commercialOrder/order/descendant::*[@tipo=''TE'' and @sottoTipo=\"MNPIN\"]','xmlns=\"http://phoenix.wind.it/esb/CommercialOrder\"'))) te    \nwhere r.name='Receive In Order'--'Receive Out Order'\nand r.status='SA'\n--and r.ts_created>sysdate-10\nand RR.ID=r.request_id\n--and rr.root_id=3449071259\nand am.id=r.message_id\nand rownum<10\n--and r.id='3450777873'\nand rr.root_id =(select distinct root_id from detail_hs where value='1-620231736226'  )",
        "outPutSql": "ID\tSTATUS\tNAME\tTS_CREATED\tTIPO_ORDINE\tSOTTOTIPO_ORDINE\tCAUSALE_ORDINE\tBSS_ORDER\tFLAG_SOSPENSIONE\tCOUNT_NETWORK\tLOGISTICA\tNUM_PRD_WLESSPREP\tNUM_PRD_WLESS\tNUM_PRD_CPEM\tNUM_PRD_GSS\tCOMPONENTROOT\tINTEGRATIONIDTE\tSOTTOTIPOTE\tCOMPONENTPADRETE\tNUMEROVOCEPORTATO\tNUMEROVOCEPRECEDENTE\tID_1\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620334054734\t1620334054778\tMNPIN\t1620334054761\t3472979188\t3299010063\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620334054816\t1620334054860\tMNPIN\t1620334054843\t3387718534\t3299042650\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620334054898\t1620334054942\tMNPIN\t1620334054925\t3337801144\t3289840248\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620334054980\t1620334055024\tMNPIN\t1620334055007\t3667748666\t3299019574\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620334055062\t1620334055106\tMNPIN\t1620334055089\t3336667105\t3289841153\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620334055144\t1620334055188\tMNPIN\t1620334055171\t3358188444\t3298316000\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620334055373\t1620335032417\tMNPIN\t1620334055400\t3924191898\t3298320435\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620335032458\t1620335032502\tMNPIN\t1620335032485\t3475347177\t3299017865\t69543892117\n69543892117\tSA\tReceive In Order\t08/04/2024 15:25:12,414268\tAttivazione\tAttivazione\tPrima Attivazione\tY\t0\t0\tN\t15\t0\t6\t0\t1620335032543\t1620335032587\tMNPIN\t1620335032570\t3396765201\t3299015484\t69543892117"
      }
    ]
  },
  {
    "id": "4",
    "nomeCapitolo": "ESTRAZIONE EMF ACTION",
    "paragrafi": [
      {
        "id": "4.1",
        "nomeParagrafo": "Estrae EMF della action a partire da una stringa nel payload , e id action",
        "codicePlSql": "select a.*,substr(b.message_xml,1,20)  from action a , action_msg b where b.id=a.message_id \nand b.message_xml like '%32%' and direction='outbound' and system='sdm' and a.ts_created>sysdate-90 and rownum<3\n--and a.id=69159398618",
        "outPutSql": "ID\tNAME\tDIRECTION\tSTATUS\tTS_REQUESTED\tTS_CREATED\tTS_ENQUEUED\tTS_FIRST_START\tTS_START\tTS_END\tPRIORITY\tTS_TODO\tQUEUE\tREQUEST_ID\tMESSAGE_ID\tSYSTEM\tCFG_ID\tHANDLER\tRESPONSE_ID\tADB_SOURCE\tRESULT\tSUBSTR(B.MESSAGE_XML,1,20)\n69697917247\tModify technical services\toutbound\tSA\t23/04/2024 08:38:51,000000\t23/04/2024 08:38:49,861836\t\t23/04/2024 08:38:51,000000\t23/04/2024 08:38:51,000000\t23/04/2024 08:38:52,000000\t1\t\tqueue.sdm.out\t3499305570\t-33318433178\tsdm\t455\t/esb2sdm/process/businessService/bwBSInvioOrdineSdmOut.process\t\t\t\t<?xml version=\"1.0\"\n69697980576\tModify technical services\toutbound\tSA\t23/04/2024 08:56:00,000000\t23/04/2024 08:55:59,574940\t\t23/04/2024 08:56:01,000000\t23/04/2024 08:56:01,000000\t23/04/2024 08:56:01,000000\t1\t\tqueue.sdm.out\t3499309540\t-33318493123\tsdm\t455\t/esb2sdm/process/businessService/bwBSInvioOrdineSdmOut.process\t\t\t\t<?xml version=\"1.0\""
      },
      {
        "id": "4.2",
        "nomeParagrafo": "Estrae le informazioni sulla action a partire da id",
        "codicePlSql": "select * from action a where --a.request_id='3498943463' and \nrownum<3",
        "outPutSql": "ID\tNAME\tDIRECTION\tSTATUS\tTS_REQUESTED\tTS_CREATED\tTS_ENQUEUED\tTS_FIRST_START\tTS_START\tTS_END\tPRIORITY\tTS_TODO\tQUEUE\tREQUEST_ID\tMESSAGE_ID\tSYSTEM\tCFG_ID\tHANDLER\tRESPONSE_ID\tADB_SOURCE\tRESULT\n3345784527\tSend Transmission Status\toutbound\tTD\t06/12/2012 09:21:14,631000\t06/12/2012 09:21:15,103175\t\t\t\t\t1\t\tqueue.siebel.out\t389488327\t\tsiebel\t3036\t/esb2siebel/process/businessService/ContactManagement/bwBSNewIntOutbCnsOut.process\t\t\t\n4405408381\tReceive Response From XCOM\tinbound\tTD\t03/04/2013 03:52:20,179000\t03/04/2013 03:52:20,412032\t\t\t\t\t1\t\tqueue.xcom.in\t489761786\t\txcom\t3046\t/esb2xcom/process/businessService/Consumer/ContactManagement/bwBSGetXcomResponseIn.process"
      },
      {
        "id": "4.3",
        "nomeParagrafo": "Estrae EMF della action a partire dall'id",
        "codicePlSql": "select to_char(substr(b.message_xml,1,60) )aa from action a , action_msg b where b.id=a.message_id and a.id=69697917247",
        "outPutSql": "AA\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ns0:esbToSdmOrder xm"
      }
    ]
  },
  {
    "id": "5",
    "nomeCapitolo": "ESTRAZIONE TIED",
    "paragrafi": [
      {
        "id": "5.1",
        "nomeParagrafo": "Estrazione dei flag che definiscono gli scenari TIED a partire dalla data e dal nome della request",
        "codicePlSql": "select * from(\nselect /* PARALLEL (64) */\nroot.id as root_id,\nroot.name as root_name,\nroot.ts_created as root_ts_created,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAnrc','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') id_BA_nrc,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAnrcOld','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') id_BA_nrc_Old,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBArc','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') id_BA_rc,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBArcOld','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') id_BA_rc_Old,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAusg','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') id_BA_usg,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAusgOld','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') id_BA_usg_Old,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:billingAccount[@id = /ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:servizioMobile/@idBAnrc]/@tipologiaCdf','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') tipologia_Cdf,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile//ns0:servizioMobile/ns0:tracciamentoNoTax/@azione','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') pre_no_tax,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/ns0:esbAttributoGenerico[ns0:nome=''FLAG_IS_MOBILE_TIED_YN'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FLAG_IS_MOBILE_TIED_YN,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''CHANGE_TARIFF_PLAN_TYPE'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') CHANGE_TARIFF_PLAN_TYPE,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''CHANGE_CLASS_TYPE'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') CHANGE_CLASS_TYPE,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_TIED_TO_PRENOTAX'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_TIED_TO_PRENOTAX,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_PRENOTAX_TO_PRENOTAX'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_PRENOTAX_TO_PRENOTAX,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_STANDARD_TO_PRENOTAX'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_STANDARD_TO_PRENOTAX,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_PRENOTAX_TO_STANDARD'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_PRENOTAX_TO_STANDARD,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_TIED_TO_TIED'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_TIED_TO_TIED,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_STANDARD_TO_TIED'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_STANDARD_TO_TIED,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_TIED_TO_STANDARD'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_TIED_TO_STANDARD,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:esbField[ns0:name=''FROM_PRENOTAX_TO_TIED'']/ns0:valore','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') FROM_PRENOTAX_TO_TIED,\nextractvalue((xmltype(doc.document_xml)),'ns0:commercialOrderCns/ns0:order/ns0:mobile/@flagCPE','xmlns:ns0=\"http://phoenix.wind.it/common/commercialOrderCns/cmfSchema.xsd\"') flagCPE\nfrom\nrequest root,\nrequest_doc doc,\nrequest sdm\nwhere\nroot.ts_created >= to_date('29/04/2024 00:00:00','dd/mm/yyyy hh24:mi:ss') and\nroot.name = 'Change Order' and -- Switch Order (subentro),Change Order (cambi offerta) , Change Tariff Plan (cambi piano) ,Activation Order (att), Deactivation Order (cssz), Change Number (?cambio numero)\nroot.id = sdm.root_id and\nsdm.name = 'Mobile Provisioning' and\nsdm.status != 'AB' and\nroot.document_id = doc.id \n--and root.id=3455031415\n)\nwhere 1=1\nand rownum<3",
        "outPutSql": "ROOT_ID\tROOT_NAME\tROOT_TS_CREATED\tID_BA_NRC\tID_BA_NRC_OLD\tID_BA_RC\tID_BA_RC_OLD\tID_BA_USG\tID_BA_USG_OLD\tTIPOLOGIA_CDF\tPRE_NO_TAX\tFLAG_IS_MOBILE_TIED_YN\tCHANGE_TARIFF_PLAN_TYPE\tCHANGE_CLASS_TYPE\tFROM_TIED_TO_PRENOTAX\tFROM_PRENOTAX_TO_PRENOTAX\tFROM_STANDARD_TO_PRENOTAX\tFROM_PRENOTAX_TO_STANDARD\tFROM_TIED_TO_TIED\tFROM_STANDARD_TO_TIED\tFROM_TIED_TO_STANDARD\tFROM_PRENOTAX_TO_TIED\tFLAGCPE\n3511411408\tChange Order\t11/05/2024 07:51:11,060673\tP1124752841\tP1124752841\tP1124752841\tP1124752841\tP1124752841\tP1124752841\tPrepagato\t\tY\tSTANDARD\t\t\t\t\t\t\t\t\t\tN\n3511414848\tChange Order\t11/05/2024 08:28:22,597977\tP1124652826\tP1124652826\tP1124652826\tP1124652826\tP1124652826\tP1124652826\tPostpagato\t-\tN\tSTANDARD\t\t\t\t\t\t\t\t\t\tN\n3511402217\tChange Order\t11/05/2024 05:53:13,689303\t\t\t\t\t\t\t\t\tN\tSTANDARD\t\t\t\t\t\t\t\t\t\tN\n3511402729\tChange Order\t11/05/2024 05:58:21,908076\t\t\t\t\t\t\t\t\tN\tSTANDARD\t\t\t\t\t\t\t\t\t\tN"
      }
    ]
  },
  {
    "id": "6",
    "nomeCapitolo": "QUERY DISCARD",
    "paragrafi": [
      {
        "id": "6.1",
        "nomeParagrafo": "Estrazione dei dettagli della discard a partire dall'id ordine",
        "codicePlSql": "select de.*,DI.RECEIVER_NAME,DI.SYSTEM,DI.TS_DISCARD,DI.ID_DISCARD,\nto_char(REGEXP_SUBSTR(error_msg, '<message>(.*?)</message>', 1, 1, NULL, 1)) AS error_message\nfrom detail de, discard2detail dd, discard di\nwhere di.id_discard = dd.id_discard\nand dd.id_detail = de.id\nand de.value like  \n( '450%') and rownum<3\norder by ts_discard desc",
        "outPutSql": "ID\tNAME\tVALUE\tPOS\tCFG_ID\tROOT_ID\tRECEIVER_NAME\tSYSTEM\tTS_DISCARD\tID_DISCARD\tERROR_MESSAGE\n39946249968\ttransaction_id\t4500017b-7b93-427a-98ac-fe329ff7b55f\t0\t2\t\tbwRecDocumentCheck\tcvp\t31/01/2024 19:07:03,845000\t261326070\t\n37826199313\ttransaction_id\t45000049-e8cf-4a2b-bc25-a28a2a39934b\t0\t2\t\tbwRecDocumentCheck\tcvp\t26/04/2023 15:00:17,863000\t254933143"
      },
      {
        "id": "6.2",
        "nomeParagrafo": "Estrazione sulla discard",
        "codicePlSql": "select * from discard where ts_discard>sysdate-4 and error_msg  like ( '%4503329465%')and  rownum<3",
        "outPutSql": "n.a."
      }
    ]
  },
  {
    "id": "7",
    "nomeCapitolo": "ESTRAZIONE OGGETTI PROPAGATI AL BILLING",
    "paragrafi": [
      {
        "id": "7.1",
        "nomeParagrafo": "query 1",
        "codicePlSql": "SELECT  a.id,\na.status,\na.name as act_name,\na.request_id req_root_id,\np.*\n,extractValue(xmltype(d.message_xml),'/ns0:activateServiceIstance/ns0:serviceIstance/ns0:numeroTelefono','xmlns:ns0=\"http://billing.wind.it/esb/OrderManagement\"')as numeroTelefono\n,extractValue(xmltype(d.message_xml),'/ns0:activateServiceIstance/ns0:serviceIstance/ns0:extIdSI','xmlns:ns0=\"http://billing.wind.it/esb/OrderManagement\"')as extIdSI\nFROM action a, request c,action_msg d,\nXMLTable(xmlnamespaces( \ndefault 'http://billing.wind.it/esb/OrderManagement' \n),\n              '/activateServiceIstance/serviceIstance//billingElement'\n              PASSING XMLTYPE(d.message_xml)\n              COLUMNS\n                extIdBE VARCHAR2(50) PATH 'extIdBE'\n                ,idBE VARCHAR2(50) PATH 'idBE'\n                ,idPrice VARCHAR2(50) PATH 'idPrice'\n                ,mdf VARCHAR2(50) PATH 'mdf'\n                ,idOrdine VARCHAR2(50) PATH 'idOrdine'\n                ) p           \n                WHERE \n                              c.id=a.request_id and\n                              c.root_id IN\n                                       (SELECT DISTINCT root_id\n                                          FROM detail\n                                         WHERE VALUE IN (\n                                                 '1-619650892429'                                        )\n        ) and a.system='kenan' and a.direction='outbound' and\n        d.id=a.message_id",
        "outPutSql": "ID\tSTATUS\tACT_NAME\tREQ_ROOT_ID\tEXTIDBE\tIDBE\tIDPRICE\tMDF\tIDORDINE\tNUMEROTELEFONO\tEXTIDSI\n69853081976\tSA\tActive Service Instance\t3507789740\t1624280975075\t162409\t\t\t1-624270874302\t\t1624275710300"
      },
      {
        "id": "7.2",
        "nomeParagrafo": "Estrazione action verso billing dalla request id root",
        "codicePlSql": "select b.name,b.id,a.root_id,b.status,''''||b.id||''',',\n(select distinct value from detail where root_id = a.root_id and name='id_odl_crm') id_ordine\nfrom request a, action  b\n      where \n      b.request_id=a.id and \n--      a.root_id in (     572744,     -1      )       \n      a.root_id in (select distinct root_id from detail where value in       ('1-622831680560'))\n--      and b.status ='SA'\n      and b.system='kenan' \n     and b.direction='outbound'\n     and b.id not in (-1)\n     and rownum<4",
        "outPutSql": "NAME\tID\tROOT_ID\tSTATUS\t''''||B.ID||''','\tID_ORDINE\nActive Service Instance\t69815515523\t3507789694\tSA\t'69815515523',\t1-624270874302\nChange Billing Element Service Instance\t69840304265\t3507789694\tSK\t'69840304265',\t1-624270874302\nChange Number Service Instance\t69815514712\t3507789694\tSA\t'69815514712',\t1-624270874302"
      },
      {
        "id": "7.3",
        "nomeParagrafo": "STORICO query 2",
        "codicePlSql": "SELECT  a.id,\na.status,\na.name as act_name,\na.request_id req_root_id,\np.*\n,extractValue(xmltype(d.message_xml),'/ns0:activateServiceIstance/ns0:serviceIstance/ns0:numeroTelefono','xmlns:ns0=\"http://billing.wind.it/esb/OrderManagement\"')as numeroTelefono\n,extractValue(xmltype(d.message_xml),'/ns0:activateServiceIstance/ns0:serviceIstance/ns0:extIdSI','xmlns:ns0=\"http://billing.wind.it/esb/OrderManagement\"')as extIdSI\nFROM action_hs a, request_hs c,action_msg_hs d,\nXMLTable(xmlnamespaces( \ndefault 'http://billing.wind.it/esb/OrderManagement' \n),\n              '/activateServiceIstance/serviceIstance//billingElement'\n              PASSING XMLTYPE(d.message_xml)\n              COLUMNS\n                extIdBE VARCHAR2(50) PATH 'extIdBE'\n                ,idBE VARCHAR2(50) PATH 'idBE'\n                ,idPrice VARCHAR2(50) PATH 'idPrice'\n                ,mdf VARCHAR2(50) PATH 'mdf'\n                ,idOrdine VARCHAR2(50) PATH 'idOrdine'\n                ) p           \n                WHERE \n                              c.id=a.request_id and\n                              c.root_id IN\n                                       (SELECT DISTINCT root_id\n                                          FROM detail_hs\n                                         WHERE VALUE IN (\n                                                 '1-622454582723'                                        )\n        ) and a.system='kenan' and a.direction='outbound' and\n        d.id=a.message_id",
        "outPutSql": "ID\tSTATUS\tACT_NAME\tREQ_ROOT_ID\tEXTIDBE\tIDBE\tIDPRICE\tMDF\tIDORDINE\tNUMEROTELEFONO\tEXTIDSI\n69835079823\tSA\tActive Service Instance\t3499976802\t1623205682276\t333115\tID_PRICE_1552\tPOSTPAGATA\t1-622454582723\tVULA.w59340500\t1623205682235\n69835079823\tSA\tActive Service Instance\t3499976802\t1623205682278\tPHX70328\tID_PRICE_919\tPOSTPAGATA\t1-622454582723\tVULA.w59340500\t1623205682235\n69835079823\tSA\tActive Service Instance\t3499976802\t1623205682275\tPHX70021\tID_PRICE_4836\tPOSTPAGATA\t1-622454582723\tVULA.w59340500\t1623205682235\n69835079967\tSA\tActive Service Instance\t3499976802\t1623205723426\t335991\tID_PRICE_3824\tPOSTPAGATA\t1-622454582723\t0118980662\t1623205682347\n69835079967\tSA\tActive Service Instance\t3499976802\t1623205723425\t335989\tID_PRICE_3822\tPOSTPAGATA\t1-622454582723\t0118980662\t1623205682347\n69835079967\tSA\tActive Service Instance\t3499976802\t1623205682391\tPHX70023\tID_PRICE_981\tPOSTPAGATA\t1-622454582723\t0118980662\t1623205682347\n69835080644\tSA\tActive Service Instance\t3499976802\t1623205682317\t335494\tID_PRICE_1778\tPOSTPAGATA\t1-622454582723\tA21623205682306\t1623205682306\n69835080644\tSA\tActive Service Instance\t3499976802\t1623205682318\t302681\tID_PRICE_1742\tPOSTPAGATA\t1-622454582723\tA21623205682306\t1623205682306"
      },
      {
        "id": "7.4",
        "nomeParagrafo": "Estrazione Billing Element a partire da Ordine su ESB (STORICO)",
        "codicePlSql": "select d.value as order_id, r.id as root_id, r.name as root_name, r.ts_created,\n(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@tipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as tipo_ordine,\n(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/@sottotipo','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as sottotipo_ordine,\n(select extractValue(xmltype(document_xml),'ns0:commercialOrder/ns0:order/ns0:causaleOrdine','xmlns:ns0=http://phoenix.wind.it/common/CommercialOrder') from request_doc where id=r.document_id) as causale_ordine,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:extIdSI','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extId_si,\nextractvalue(xmltype(m.message_xml),'descendant::ns0:numeroTelefono','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as numeroTelefono,\nextractvalue(value(t),'ns0:billingElement/ns0:extIdBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as extid_BE,\nextractvalue(value(t),'ns0:billingElement/ns0:typeOpBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as type_op_BE,\nextractvalue(value(t),'ns0:billingElement/ns0:idBE','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as id_BE,\nextractvalue(value(t),'ns0:billingElement/ns0:dtAttivazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtAttivazione_BE,\nextractvalue(value(t),'ns0:billingElement/ns0:dtCessazione','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as dtCessazione_BE,\nextractvalue(value(t),'ns0:billingElement/ns0:idOrdine','xmlns:ns0=http://billing.wind.it/esb/OrderManagement') as idordine_BE\nfrom request r, detail d, request r1, action a, action_msg m,\nTABLE ( XMLSEQUENCE(EXTRACT(xmltype(m.message_XML),'descendant::ns0:billingElement', 'xmlns:ns0=http://billing.wind.it/esb/OrderManagement'))) t\nwhere r.id=d.root_id\nand d.name='id_odl_crm'\nand d.value in ('1-615780063860')\nand r.id=r1.root_id\nand r1.id=a.request_id\nand a.message_id=m.id\nand a.system='kenan'\nand a.direction='outbound';",
        "outPutSql": "ORDER_ID\tROOT_ID\tROOT_NAME\tTS_CREATED\tTIPO_ORDINE\tSOTTOTIPO_ORDINE\tCAUSALE_ORDINE\tEXTID_SI\tNUMEROTELEFONO\tEXTID_BE\tTYPE_OP_BE\tID_BE\tDTATTIVAZIONE_BE\tDTCESSAZIONE_BE\tIDORDINE_BE\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783458985\tA21615783458985\t1615783502880\tADD\t302681\t2024-02-09T15:34:26+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783458985\tA21615783458985\t1615783458997\tADD\t335494\t2024-02-09T15:34:26+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703444\tFTTH.w50667885\t1615783703555\tADD\t333323\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703444\tFTTH.w50667885\t1615866117549\tADD\t333326\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703444\tFTTH.w50667885\t1615783703481\tADD\t332998\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703444\tFTTH.w50667885\t1615866117505\tADD\t335713\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703444\tFTTH.w50667885\t1615783703531\tADD\t335043\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703444\tFTTH.w50667885\t1615866117527\tADD\t333116\t2024-02-08T00:00:00+01:00\t2026-01-26T00:00:00+01:00\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703322\t089406467\t1615783703397\tADD\t332994\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703322\t089406467\t1615866117317\tADD\t335989\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703322\t089406467\t1615868990992\tADD\t335991\t2024-02-08T00:00:00+01:00\t2063-06-30T00:00:00+01:00\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t1615783703322\t089406467\t1615783703369\tADD\t333045\t2024-02-08T00:00:00+01:00\t\t1-615780063860\n1-615780063860\t3438299609\tIn Order\t26/01/2024 15:50:52,133001\tAttivazione\tAttivazione\tPrima Attivazione\t\t\t1615783502713\tADD\t160433\t2024-02-08T00:00:00+01:00\t\t1-615780063860"
      }
    ]
  },
  {
    "id": "8",
    "nomeCapitolo": "ESTRAZIONE MEDIANTE REGULAR EXPRESSION",
    "paragrafi": [
      {
        "id": "8.1",
        "nomeParagrafo": "Estrazione di un campo dell'action message non ricorsivo",
        "codicePlSql": "select a.id,a.name,\n        (select to_char(REGEXP_SUBSTR(zz.message_xml, '<RSP__PROVISIONINGDESCRIPTION>(.*?)</RSP__PROVISIONINGDESCRIPTION>', 1, 1, NULL, 1)) \n            from action z,action_msg zz \n                where z.name='Receive mobile provisioning result KO' \n                and z.request_id=a.request_id \n                and zz.id=z.message_id \n                and z.id=(select max(id) from action x where x.name='Receive mobile provisioning result KO' and x.request_id=a.request_id) \n         ) descr\n        from action a where id in\n        (\n        66078832342,\n66073801202)",
        "outPutSql": "ID\tNAME\tDESCR\n66073801202\tModify technical services\tInterfaceVerifyRespFunctionEDA: e' stata ricevuta una risposta negativa '13003'\n66078832342\tModify technical services\tInterfaceVerifyRespFunctionEDA: e' stata ricevuta una risposta negativa '13003'"
      }
    ]
  },
  {
    "id": "9",
    "nomeCapitolo": "ESTRAZIONE RISORSE",
    "paragrafi": [
      {
        "id": "9.1",
        "nomeParagrafo": "Estrazione action verso il mobile resource",
        "codicePlSql": "select a.name, c.name,b.name from \nrequest a, \naction b,\nrequest c,\naction_msg d\nwhere \nd.id=b.message_id and\nc.root_id=A.ID and\n--c.name='Network' and\nb.request_id=c.id and \nb.handler like '%mobileResource%' and\nb.system in ('clarify','esb') and \na.ts_created>sysdate-70 and\na.name  in \n('Change-over'\n/*'In Order',\n'OutOrder', --==> \n'Extend Order',\n'Sim/Handset Change', --==> \n'MnpDonor', --==> \n'Change Number Mnp' --==> \n*/) and\nrownum<3",
        "outPutSql": "NAME\tNAME_1\tNAME_2\nChange-over\tNetwork\tUpdate SIM\nChange-over\tNetwork\tUpdate SIM"
      }
    ]
  },
  {
    "id": "10",
    "nomeCapitolo": "QUERY GENERICHE",
    "paragrafi": [
      {
        "id": "10.1",
        "nomeParagrafo": "Estrazione casistiche con nome della request padre e figlie",
        "codicePlSql": "SELECT c.*\n  FROM \n              request a, \n              request b, \n              action c\n WHERE     a.name = 'Network'\n       AND a.ts_created > SYSDATE - 10\n       AND ROWNUM < 10\n       AND b.id = a.root_id\n       AND b.name = 'In Order'\n       AND c.request_id = a.id\n       AND c.SYSTEM = 'dbag'\n       AND b.status = 'SA'\n       and b.id=3508996329\n       AND EXISTS\n              (SELECT 1\n                 FROM request\n                WHERE name = 'MnpRecipient' AND root_id = b.id) and rownum<3",
        "outPutSql": "ID\tNAME\tDIRECTION\tSTATUS\tTS_REQUESTED\tTS_CREATED\tTS_ENQUEUED\tTS_FIRST_START\tTS_START\tTS_END\tPRIORITY\tTS_TODO\tQUEUE\tREQUEST_ID\tMESSAGE_ID\tSYSTEM\tCFG_ID\tHANDLER\tRESPONSE_ID\tADB_SOURCE\tRESULT\n69856171974\tNotify Activation PS\toutbound\tSA\t10/05/2024 08:21:05,000000\t10/05/2024 08:21:06,086635\t\t10/05/2024 08:21:07,000000\t10/05/2024 08:21:07,000000\t10/05/2024 08:21:07,000000\t1\t\tqueue.dbag.out\t3508996341\t-33467750917\tdbag\t38\t/esb2dbag/process/businessService/OrderManagement/bwBSNotifyAssetLineItemOut.process\t\t\t\n69856175715\tNotify Activation PS\toutbound\tSA\t10/05/2024 08:22:39,000000\t10/05/2024 08:22:40,012879\t\t10/05/2024 08:22:40,000000\t10/05/2024 08:22:40,000000\t10/05/2024 08:22:40,000000\t1\t\tqueue.dbag.out\t3508996346\t-33467754511\tdbag\t38\t/esb2dbag/process/businessService/OrderManagement/bwBSNotifyAssetLineItemOut.process"
      },
      {
        "id": "10.2",
        "nomeParagrafo": "Estrazione casi request root name",
        "codicePlSql": "SELECT c.*\n  FROM \n        request a,\n       request b,\n       action c,\n       action_msg d\n WHERE 1=1 \n       AND b.name = 'Activation Order'\n       and b.id=a.root_id\n       and a.id=c.request_id\n       and d.id=c.message_id\n       AND a.ts_created > SYSDATE - 10\n       AND ROWNUM < 3\n       and c.system='pos'\n       and c.direction='inbound'\n       --and d.message_xml like '%ROPZ4362%'",
        "outPutSql": "ID\tNAME\tDIRECTION\tSTATUS\tTS_REQUESTED\tTS_CREATED\tTS_ENQUEUED\tTS_FIRST_START\tTS_START\tTS_END\tPRIORITY\tTS_TODO\tQUEUE\tREQUEST_ID\tMESSAGE_ID\tSYSTEM\tCFG_ID\tHANDLER\tRESPONSE_ID\tADB_SOURCE\tRESULT\n69876184608\tReceive Activation Order\tinbound\tSA\t12/05/2024 17:19:09,035000\t12/05/2024 17:19:09,083077\t\t12/05/2024 17:19:09,000000\t12/05/2024 17:19:09,000000\t12/05/2024 17:19:09,000000\t1\t\tqueue.pos.cns.in\t3511902210\t-33486752478\tpos\t2168\t/esb2siebelCns/process/businessService/Order/bwBSGestOrd155PosIn.process\t\t\t\n69875904624\tReceive Activation Order\tinbound\tSA\t12/05/2024 15:42:41,448000\t12/05/2024 15:42:41,497840\t\t12/05/2024 15:42:41,000000\t12/05/2024 15:42:41,000000\t12/05/2024 15:42:41,000000\t1\t\tqueue.pos.cns.in\t3511885901\t-33486487511\tpos\t2168\t/esb2siebelCns/process/businessService/Order/bwBSGestOrd155PosIn.process"
      }
    ]
  },
  {
    "id": "11",
    "nomeCapitolo": "Estrazioni per anomalia RELOAD",
    "paragrafi": [
      {
        "id": "11.1",
        "nomeParagrafo": "Estrazione campi EMF della create subscription (RELOAD)",
        "codicePlSql": "select a.id,a.name,c.id reqChildid,c.root_id ,c.name childName,d.name rootName,\n,extractValue(xmltype(b.message_xml),'ns0:CRMCarrierCreateSubscriptionReconnect/CRMCarrierCreateSubscriptionReconnectRequest/phone/itemCode','xmlns:ns0=\"http://www.wind3/igp/wsdl/createsubscription\"')as codMat \n,extractValue(xmltype(b.message_xml),'ns0:CRMCarrierCreateSubscriptionReconnect/CRMCarrierCreateSubscriptionReconnectRequest/phone/imei','xmlns:ns0=\"http://www.wind3/igp/wsdl/createsubscription\"')as imei\n,extractValue(xmltype(b.message_xml),'ns0:CRMCarrierCreateSubscriptionReconnect/CRMCarrierCreateSubscriptionReconnectRequest/externalId','xmlns:ns0=\"http://www.wind3/igp/wsdl/createsubscription\"')as intIdRopz\nfrom action a ,action_msg b,request c ,request d\nwhere a.name ='Create Subscription Reconnect' and a.status='SA' and a.ts_created>sysdate-150 --13733\nand a.request_id=c.id\nand d.id=c.root_id\nand b.id=a.message_id  \n--and rownum<3\n\n-- query da lanciare su siebel per recupero fasce \n\nselect * from siebel.win_fasce_BOL_OE -- reload open\n\nselect * from siebel.win_fasce_BOLTECH --reload plus\n\nselect * from siebel.win_fasce_reconnects -- reload standard",
        "outPutSql": "ID\tNAME\tREQCHILDID\tROOT_ID\tCHILDNAME\tROOTNAME\tCODMAT\tIMEI\tINTIDROPZ\n68712665460\tCreate Subscription Reconnect\t3425872708\t3425863495\tMobile Provisioning\tChange Order\t0TZTBL53OU7004\t866502068872322\t1614483507176\n70002415872\tCreate Subscription Reconnect\t3519228606\t3519221503\tMobile Provisioning\tActivation Order\t0TAL255MOU0001\t350814294641220\t1625728566073\n68814127243\tCreate Subscription Reconnect\t3433791363\t3433790377\tMobile Provisioning\tActivation Order\t\t358780103107707\t1615318074574\n69989952729\tCreate Subscription Reconnect\t3517080723\t3517078728\tMobile Provisioning\tActivation Order\t0TAL1250OU0001\t353350908326301\t1625461003947"
      }
    ]
  },
  {
    "id": "12",
    "nomeCapitolo": "ESTRAZIONI FISSO B2B",
    "paragrafi": [
      {
        "id": "12.1",
        "nomeParagrafo": "Estrazione codice pin da id ordine o request id",
        "codicePlSql": "select \n  extractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:idCommercialOrder','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"')as idCommercialOrder,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/@tipo','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"')as tipo_ordine,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/@sottotipo','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as sottotipo_ordine,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:bssOrder','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as bssOrder,\nextractValue(xmltype(d.document_xml),'ns0:commercialOrder/ns0:order/ns0:causaleOrdine','xmlns:ns0=\"http://phoenix.wind.it/common/CommercialOrder\"') as causale_ordine\n,p.codicePin\n  from \nrequest_hs a,request_doc_hs d,\naction_hs b,\nrequest_hs c\n,XMLTable(xmlnamespaces( \n 'http://phoenix.wind.it/common/CommercialOrder' as \"ns0\" \n),\n              '/ns0:commercialOrder/ns0:order//descendant::*/*[@tipo=\"TE\" and @sottoTipo=\"DATLA\"]'\n              PASSING XMLTYPE(d.document_xml)\n              COLUMNS\n                codicePin VARCHAR2(50) PATH 'ns0:codicePin'\n                ) p         \nwhere 1=1 and\na.id=c.root_id and\nc.id=b.request_id and\na.name='In Order' and \nb.name='Send Start Pin to CRM' and \nc.name='Service Provisioning'  and \nd.id=a.document_id and",
        "outPutSql": "IDCOMMERCIALORDER\tTIPO_ORDINE\tSOTTOTIPO_ORDINE\tBSSORDER\tCAUSALE_ORDINE\tCODICEPIN\n1-629047550831\tAttivazione\tAttivazione\tY\tPrima Attivazione\tFWI0997776822001"
      }
    ]
  },
  {
    "id": "13",
    "nomeCapitolo": "Inserisci il nome del Capitolo",
    "paragrafi": [
      {
        "id": "13.1",
        "nomeParagrafo": "Inserisci il nome del Paragrafo",
        "codicePlSql": "Scrivi qui il codice PLSQL",
        "outPutSql": "Incolla qui la tua tabella"
      }
    ]
  }
]